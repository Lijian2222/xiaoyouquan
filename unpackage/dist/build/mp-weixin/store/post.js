"use strict";const e=require("../common/vendor.js"),t=require("./environment.js").environmentStore().currentUrl,a=e.defineStore("post",(()=>{const a=e.ref([]),o=e.ref([]),u=e.ref([]);function d(e){const t=new Date(e.publishTime),a=`${(t.getMonth()+1).toString().padStart(2,0)}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`;e.publishTime=a}const i=e.ref(new Map);return{list1:a,list2:o,list3:u,getList1:async function(o){let u=await e.index.request({url:t+"/post/query",method:"post",data:{isDeleted:0,pageIndex:o,pageSize:5}});u.data.data.forEach((e=>{d(e),i.value.set(e.id,e)})),a.value=[...a.value,...u.data.data]},getList2:async function(a){let u=await e.index.request({url:t+"/post/query",method:"post",data:{isDeleted:0,campus:"哈尔滨工业大学",pageIndex:a,pageSize:5}});u.data.data.forEach(d),o.value=[...o.value,...u.data.data]},getList3:async function(a){let o=await e.index.request({url:t+"/post/query",method:"post",data:{isDeleted:0,currentUserId:1,pageIndex:a,pageSize:5}});o.data.data.forEach(d),u.value=[...u.value,...o.data.data]},notInteresting:function(e){a.value=a.value.filter((t=>t.id!=e)),o.value=o.value.filter((t=>t.id!=e)),u.value=u.value.filter((t=>t.id!=e))},formatNumber:function(e){return e>=0&&e<1e3?e.toString():e>=1e3&&e<1e4?(e/1e3).toFixed(1)+"k":e>=1e4?(e/1e4).toFixed(1)+"w":"Number out of range"},requestGood:function(a){return new Promise(((o,u)=>{e.index.request({url:t+"/postGood/query",method:"POST",data:{postId:a,isDeleted:0,userId:1},success:e=>{1==e.data.data?o(!0):o(!1)},fail:e=>{u(e)}})}))},addGoodNums:function(e){if(i.value.has(e)){const t=i.value.get(e);t.goodNums++,i.value.set(e,t)}},subGoodNums:function(e){a.value.map(((t,a)=>(t.id==e&&t.goodNums--,t))),o.value.map(((t,a)=>(t.id==e&&t.goodNums--,t))),u.value.map(((t,a)=>(t.id==e&&t.goodNums--,t)))},addView:function(d){e.index.request({url:t+"/post/addViewNums",method:"GET",data:{postId:d}}),a.value.map(((e,t)=>(e.id==d&&e.viewNums++,e))),o.value.map(((e,t)=>(e.id==d&&e.viewNums++,e))),u.value.map(((e,t)=>(e.id==d&&e.viewNums++,e)))},handleTime:d}}));exports.postStore=a;
