{"version":3,"file":"user.js","sources":["store/user.js"],"sourcesContent":["//用户仓库，用来保存用户资料\r\nimport { defineStore } from \"pinia\"\r\nimport { ref } from \"vue\"\r\n\r\nimport { environmentStore } from \"./environment\"\r\nconst currentUrl = environmentStore().currentUrl\r\n\r\n//post是仓库的唯一标识\r\nexport const userStore = defineStore('user',()=>{\r\n\t\r\n\t\r\n\t//查询用户有哪些学校\r\n\tfunction queryCampus(){\r\n\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\tuni.request({\r\n\t\t\t\t// url:'http://localhost:8080/user/query',\r\n\t\t\t\turl:currentUrl+'/user/query', //生产环境\r\n\t\t\t\tmethod:'post',\r\n\t\t\t\tdata:{\r\n\t\t\t\t\t\"id\":userId,\r\n\t\t\t\t},\r\n\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\tconst user = res.data.data\r\n\t\t\t\t\tconst campus = []\r\n\t\t\t\t\tif (user.campus1!=null){\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus1,\r\n\t\t\t\t\t\t\t\"value\":user.campus1\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (user.campus2!=null){\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus2,\r\n\t\t\t\t\t\t\t\"value\":user.campus2\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (user.campus3!=null){\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus3,\r\n\t\t\t\t\t\t\t\"value\":user.campus3\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(campus)\r\n\t\t\t\t},\r\n\t\t\t\tfail:(err)=>{\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\t\r\n\tconst campus = []\r\n\t\r\n\tfunction logInSuccess(){\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '登录成功', // 提示内容\r\n\t\t\ticon: 'success',  // 图标类型（success、loading、none）\r\n\t\t\tduration: 2000,   // 显示时长（毫秒）\r\n\t\t\tmask: true,       // 是否显示透明蒙层，防止触摸穿透\r\n\t\t\tsuccess: () => {\r\n\t\t\t\tconsole.log('Toast 显示成功');\r\n\t\t\t}\r\n\t\t})\r\n\t\t// uni.navigateTo({\r\n\t\t//     url: '/pages/index/index', // 目标页面路径\r\n\t\t//     success: () => {\r\n\t\t//         console.log('跳转成功');\r\n\t\t//     },\r\n\t\t//     fail: (err) => {\r\n\t\t//         console.error('跳转失败', err);\r\n\t\t//     }\r\n\t\t// })\r\n\t\tuni.switchTab({\r\n\t\t    url: '/pages/index/index', // 替换为你的 TabBar 页面路径\r\n\t\t    success: () => {\r\n\t\t        console.log('跳转成功');\r\n\t\t    },\r\n\t\t    fail: (err) => {\r\n\t\t        console.error('跳转失败', err);\r\n\t\t    }\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction logIn(phoneNumber,password){\r\n\t\t// console.log(\"logIn触发\")\r\n\t\t// console.log(phoneNumber)\r\n\t\t// console.log(password)\r\n\t\tuni.request({\r\n\t\t\t// url:'http://localhost:8080/user/logIn',\r\n\t\t\turl:currentUrl+'/user/logIn', //生产环境\r\n\t\t\tmethod:'post',\r\n\t\t\tdata:{\r\n\t\t\t\t\"phoneNumber\":phoneNumber,\r\n\t\t\t\t\"password\":password\r\n\t\t\t},\r\n\t\t\tsuccess:(res)=>{\r\n\t\t\t\tconst user = res.data.data\r\n\t\t\t\t// console.log(user)\r\n\t\t\t\tif (user!=null){ //user不为空，说明登录或者注册成功，载入相关资料\r\n\t\t\t\t\tconsole.log(\"登录注册成功\")\r\n\t\t\t\t\tuserId.value = user.id //载入用户id\r\n\t\t\t\t\tsetTimeout(logInSuccess,5000) //5s后显示登录成功\r\n\t\t\t\t\tif (user.campus1!=null){ //载入学校资料\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus1,\r\n\t\t\t\t\t\t\t\"value\":user.campus1\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (user.campus2!=null){\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus2,\r\n\t\t\t\t\t\t\t\"value\":user.campus2\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (user.campus3!=null){\r\n\t\t\t\t\t\tcampus.push({\r\n\t\t\t\t\t\t\t\"text\":user.campus3,\r\n\t\t\t\t\t\t\t\"value\":user.campus3\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//载入用户昵称\r\n\t\t\t\t\tif (user.nickname!=null){\r\n\t\t\t\t\t\tusername.value=user.nickname\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//载入用户头像\r\n\t\t\t\t\tif (user.profilePicture!=null){\r\n\t\t\t\t\t\tuserHeadPicture.value = user.profilePicture \r\n\t\t\t\t\t}\r\n\t\t\t\t\t// resolve(campus)\r\n\t\t\t\t\tlogInFlag.value = true //flag变成true\r\n\t\t\t\t}else{ //如果用户为空，说明密码错误\r\n\t\t\t\t\tconsole.log(\"密码错误\")\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tfail:(err)=>{\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\tconst logInFlag = ref(false)\r\n\tconst userId = ref(-1)\r\n\tconst username = ref(\"点此建立昵称\")\r\n\tconst userHeadPicture = ref(\"../../static/user4.png\")\r\n\treturn {\r\n\t\tlogIn,\r\n\t\tcampus,\r\n\t\tlogInFlag,\r\n\t\tuserId,\r\n\t\tusername,\r\n\t\tuserHeadPicture\r\n\t}\r\n})"],"names":["environmentStore","defineStore","uni","ref"],"mappings":";;;AAKA,MAAM,aAAaA,kBAAgB,iBAAA,EAAG;AAG1B,MAAC,YAAYC,cAAAA,YAAY,QAAO,MAAI;AA2C/C,QAAM,SAAS,CAAE;AAEjB,WAAS,eAAc;AACtBC,kBAAAA,MAAI,UAAU;AAAA,MACb,OAAO;AAAA;AAAA,MACP,MAAM;AAAA;AAAA,MACN,UAAU;AAAA;AAAA,MACV,MAAM;AAAA;AAAA,MACN,SAAS,MAAM;AACdA,sBAAAA,0CAAY,YAAY;AAAA,MACxB;AAAA,IACJ,CAAG;AAUDA,kBAAAA,MAAI,UAAU;AAAA,MACV,KAAK;AAAA;AAAA,MACL,SAAS,MAAM;AACXA,sBAAAA,MAAY,MAAA,OAAA,uBAAA,MAAM;AAAA,MACrB;AAAA,MACD,MAAM,CAAC,QAAQ;AACXA,sBAAc,MAAA,MAAA,SAAA,uBAAA,QAAQ,GAAG;AAAA,MAC5B;AAAA,IACP,CAAG;AAAA,EACD;AAED,WAAS,MAAM,aAAY,UAAS;AAInCA,kBAAAA,MAAI,QAAQ;AAAA;AAAA,MAEX,KAAI,aAAW;AAAA;AAAA,MACf,QAAO;AAAA,MACP,MAAK;AAAA,QACJ,eAAc;AAAA,QACd,YAAW;AAAA,MACX;AAAA,MACD,SAAQ,CAAC,QAAM;AACd,cAAM,OAAO,IAAI,KAAK;AAEtB,YAAI,QAAM,MAAK;AACdA,wBAAAA,2CAAY,QAAQ;AACpB,iBAAO,QAAQ,KAAK;AACpB,qBAAW,cAAa,GAAI;AAC5B,cAAI,KAAK,WAAS,MAAK;AACtB,mBAAO,KAAK;AAAA,cACX,QAAO,KAAK;AAAA,cACZ,SAAQ,KAAK;AAAA,YACpB,CAAO;AAAA,UACD;AACD,cAAI,KAAK,WAAS,MAAK;AACtB,mBAAO,KAAK;AAAA,cACX,QAAO,KAAK;AAAA,cACZ,SAAQ,KAAK;AAAA,YACpB,CAAO;AAAA,UACD;AACD,cAAI,KAAK,WAAS,MAAK;AACtB,mBAAO,KAAK;AAAA,cACX,QAAO,KAAK;AAAA,cACZ,SAAQ,KAAK;AAAA,YACpB,CAAO;AAAA,UACD;AAED,cAAI,KAAK,YAAU,MAAK;AACvB,qBAAS,QAAM,KAAK;AAAA,UACpB;AAED,cAAI,KAAK,kBAAgB,MAAK;AAC7B,4BAAgB,QAAQ,KAAK;AAAA,UAC7B;AAED,oBAAU,QAAQ;AAAA,QACvB,OAAS;AACJA,wBAAAA,MAAY,MAAA,OAAA,wBAAA,MAAM;AAAA,QAClB;AAAA,MAED;AAAA,MACD,MAAK,CAAC,QAAM;AACX,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACD;AAED,QAAM,YAAYC,cAAG,IAAC,KAAK;AAC3B,QAAM,SAASA,kBAAI,EAAE;AACrB,QAAM,WAAWA,cAAG,IAAC,QAAQ;AAC7B,QAAM,kBAAkBA,cAAG,IAAC,wBAAwB;AACpD,SAAO;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AACF,CAAC;;"}