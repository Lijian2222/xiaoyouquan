{"version":3,"names":["currentUrl","store_environment","environmentStore","postStore","common_vendor","defineStore","list1","ref","list2","list3","handleTime","itemment","date","Date","publishTime","month","getMonth","toString","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","formattedTime","concat","formatNumber","num","toFixed","getList1","_getList","apply","arguments","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","wrap","_callee$","_context","prev","next","index","request","url","header","method","data","sent","forEach","value","stop","getList2","_getList2","_callee2","_callee2$","_context2","getList3","_getList3","_callee3","_callee3$","_context3","notInteresting","postId","filter","item","id","requestGood","Promise","resolve","reject","success","fail","err","addGoodNums","map","goodNums","subGoodNums","addView","viewNums"],"sources":["post.js"],"sourcesContent":["// 帖子仓库\r\nimport { defineStore } from \"pinia\"\r\nimport { ref } from \"vue\"\r\n\r\nimport { environmentStore } from \"./environment\"\r\nconst currentUrl = environmentStore().currentUrl\r\n\r\n//post是仓库的唯一标识\r\nexport const postStore = defineStore('post',()=>{\r\n\tconst list1 = ref([]) //首页帖子 推荐\r\n\tconst list2 = ref([]) //首页帖子 校友圈\r\n\tconst list3 = ref([]) //首页帖子 关注\r\n\t\r\n\tfunction handleTime(itemment) { //发布时间处理成 12-17 19：23：01的格式\r\n\t\t// 创建一个新的 Date 对象\r\n\t\tconst date=new Date(itemment.publishTime)\r\n\t\t// 获取月份（加1因为 getMonth() 返回的月份是从0开始的）\r\n\t\tconst month = (date.getMonth()+1).toString().padStart(2,0)\r\n\t\t// 获取日期\r\n\t\tconst day = date.getDate().toString().padStart(2, '0')\r\n\t\t// 获取小时\r\n\t\tconst hours = date.getHours().toString().padStart(2, '0')\r\n\t\t// 获取分钟\r\n\t\tconst minutes = date.getMinutes().toString().padStart(2, '0')\r\n\t\t// 获取秒\r\n\t\tconst seconds = date.getSeconds().toString().padStart(2, '0')\r\n\t\t// 拼接成所需的格式\r\n\t\tconst formattedTime = `${month}-${day} ${hours}:${minutes}:${seconds}`\r\n\t\t//重新赋值\r\n\t\titemment.publishTime=formattedTime\r\n\t}\r\n  \r\n\tfunction formatNumber(num) {\r\n\t\tif (num >= 0 && num < 1000) {\r\n\t\t\treturn num.toString();\r\n\t\t} else if (num >= 1000 && num < 10000) {\r\n\t\t\treturn (num / 1000).toFixed(1) + 'k';\r\n\t\t} else if (num >= 10000) {\r\n\t\t\treturn (num / 10000).toFixed(1) + 'w';\r\n\t\t} else {\r\n\t\t\treturn 'Number out of range';\r\n\t\t}\r\n\t}\r\n\t\r\n\tasync function getList1(){\r\n\t\tlet res = await uni.request({\r\n\t\t\t// url:'http://localhost:8080/post/query',\r\n\t\t\turl:currentUrl+'/post/query',\r\n\t\t\theader: { 'content-type': 'application/x-www-form-urlencoded', },\r\n\t\t\tmethod:'post',\r\n\t\t\tdata:{\r\n\t\t\t\t\"isDeleted\":0,\r\n\t\t\t}\r\n\t\t})\r\n\t\t// console.log(res)\r\n\t\tres.data.data.forEach( \r\n\t\t\thandleTime\r\n\t\t)\r\n\t\tlist1.value = res.data.data\r\n\t\t// console.log(list1)\r\n\t}\r\n\t\r\n\tasync function getList2(){\r\n\t\tlet res = await uni.request({\r\n\t\t\t// url:'http://localhost:8080/post/query', //测试环境\r\n\t\t\turl:currentUrl+'/post/query', //生产环境\r\n\t\t\tmethod:'post',\r\n\t\t\tdata:{\r\n\t\t\t\t\"isDeleted\":0,\r\n\t\t\t\t\"campus\":'哈尔滨工业大学'//暂时写死\r\n\t\t\t}\r\n\t\t})\r\n\t\tres.data.data.forEach(\r\n\t\t\thandleTime\r\n\t\t)\r\n\t\tlist2.value = res.data.data\r\n\t}\r\n\r\n\tasync function getList3(){\r\n\t\tlet res = await uni.request({\r\n\t\t\t// url:'http://localhost:8080/post/query', \r\n\t\t\turl:currentUrl+'/post/query', //生产环境\r\n\t\t\tmethod:'post',\r\n\t\t\tdata:{\r\n\t\t\t\t\"isDeleted\":0,\r\n\t\t\t\t\"currentUserId\":1//暂时写死\r\n\t\t\t}\r\n\t\t})\r\n\t\tres.data.data.forEach(\r\n\t\t\thandleTime\r\n\t\t)\r\n\t\tlist3.value = res.data.data\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\tfunction notInteresting(postId){ //不感兴趣后，推荐，校友圈，关注都将会看不见\r\n\t\tlist1.value = list1.value.filter(item=>item.id!=postId)\r\n\t\tlist2.value = list2.value.filter(item=>item.id!=postId)\r\n\t\tlist3.value = list3.value.filter(item=>item.id!=postId)\r\n\t}\r\n\t\r\n\t\r\n\t// 异步方法想要return结果，必须使用promise或者async/await\r\n\tfunction requestGood(postId){//请求该用户是否点赞过这个帖子，每个帖子都会请求一次后端\r\n\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\tuni.request({\r\n\t\t\t\t// url:'http://localhost:8080/postGood/query', \r\n\t\t\t\turl:currentUrl+'/postGood/query', //生产环境\r\n\t\t\t\tmethod:'POST',\r\n\t\t\t\tdata:{\r\n\t\t\t\t\t\"postId\":postId,\r\n\t\t\t\t\t\"isDeleted\":0,//如果点赞过且isDeleted=0\r\n\t\t\t\t\t\"userId\":1 //暂时写死\r\n\t\t\t\t},\r\n\t\t\t\tsuccess:(res) => {\r\n\t\t\t\t\t// console.log(res)\r\n\t\t\t\t\tif(res.data.data==1){//如果点赞了这个帖子\r\n\t\t\t\t\t\tresolve(true)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tresolve(false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail:(err) => {\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\t\r\n\t\r\n\tfunction addGoodNums(postId){ //点赞后本地数据+1，不用重新请求后端\r\n\t\tlist1.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist2.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist3.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t}\r\n\t\r\n\tfunction subGoodNums(postId){ //取消点赞后本地数据-1，不用重新请求后端\r\n\t\tlist1.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums--\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist2.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums--\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist3.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.goodNums--\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t}\t\r\n\t\r\n\t//用户点击内容，不仅发生跳转，还会增加浏览量,本地增加,不用重新请求后端\r\n\tfunction addView(postId){\r\n\t\tlist1.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.viewNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist2.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.viewNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t\tlist3.value.map((item,index)=>{\r\n\t\t\tif(item.id==postId){\r\n\t\t\t\titem.viewNums++\r\n\t\t\t}\r\n\t\t\treturn item\r\n\t\t})\r\n\t}\r\n\t\r\n\t\r\n\treturn {\r\n\t\tlist1,\r\n\t\tlist2,\r\n\t\tlist3,\r\n\t\tgetList1,\r\n\t\tgetList2,\r\n\t\tgetList3,\r\n\t\tnotInteresting,\r\n\t\tformatNumber,\r\n\t\trequestGood,\r\n\t\taddGoodNums,\r\n\t\tsubGoodNums,\r\n\t\taddView\r\n\t}\r\n})"],"mappings":"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","ignoreList":[]}